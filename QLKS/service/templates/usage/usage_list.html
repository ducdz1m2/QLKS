{% extends "base.html" %}
{% block title %}Danh s√°ch S·ª≠ D·ª•ng D·ªãch V·ª•{% endblock %}

{% block content %}
<div class="container">
  <h2 class="text-center">Danh S√°ch S·ª≠ D·ª•ng D·ªãch V·ª•</h2>
  <div class="mb-3 text-end">
    <a href="{% url 'export_usage_excel' %}" class="btn btn-outline-primary ms-2" target="_blank">üì• Xu·∫•t danh s√°ch s·ª≠ d·ª•ng d·ªãch v·ª•</a>
  </div>

  <!-- Form t√¨m ki·∫øm s·ª≠ d·ª•ng d·ªãch v·ª• -->
  <form method="GET" action="{% url 'search_usages' %}" class="mb-3 p-3 bg-light rounded shadow-sm">
    <div class="row g-2 align-items-center">
      <div class="col-md-3">
        <input type="number" name="MaSuDung" class="form-control" placeholder="Nh·∫≠p m√£ s·ª≠ d·ª•ng" value="{{ request.GET.MaSuDung }}">
      </div>

      <div class="col-md-3">
        <input type="text" name="TenKhachHang" class="form-control" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng" value="{{ request.GET.TongTien }}">
      </div>

      <div class="col-md-3">
        <select name="SoPhong" class="form-select">
          <option value="">-- S·ªë ph√≤ng --</option>
          {% for room in rooms %}
          <option value="{{ room.SoPhong }}" {% if request.GET.SoPhong == room.SoPhong %}selected{% endif %}>
            {{ room.SoPhong }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <input type="date" name="NgaySuDung" class="form-control" placeholder="Nh·∫≠p ng√†y s·ª≠ d·ª•ng" value="{{ request.GET.NgaySuDung }}">
      </div>

      <div class="col-md-3">
        <select name="TenDichVu" class="form-select">
          <option value="">-- T√™n d·ªãch v·ª• --</option>
          {% for service in services %}
          <option value="{{ service.TenDichVu }}" {% if request.GET.TenDichVu == service.TenDichVu %}selected{% endif %}>{{ service.TenDichVu }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <input type="number" name="GiaDichVu" class="form-control" placeholder="Nh·∫≠p gi√° d·ªãch v·ª•" value="{{ request.GET.GiaDichVu }}">
      </div>

      <div class="col-md-3">
        <select name="TrangThai" class="form-select">
          <option value="">-- Tr·∫°ng th√°i --</option>
          <option value="ƒêang ch·ªù x·ª≠ l√Ω" {% if request.GET.TrangThai == "ƒêang ch·ªù x·ª≠ l√Ω" %}selected{% endif %}>ƒêang ch·ªù x·ª≠ l√Ω</option>
          <option value="ƒêang x·ª≠ l√Ω" {% if request.GET.TrangThai == "ƒêang x·ª≠ l√Ω" %}selected{% endif %}>ƒêang x·ª≠ l√Ω</option>
          <option value="Ho√†n th√†nh" {% if request.GET.TrangThai == "Ho√†n th√†nh" %}selected{% endif %}>Ho√†n th√†nh</option>
        </select>
      </div>
      
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100">üîç T√¨m ki·∫øm</button>
      </div>
    </div>
  </form>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>M√£ s·ª≠ d·ª•ng</th>
        <th>T√™n Kh√°ch H√†ng</th>
        <th>S·ªë ph√≤ng</th>
        <th>T√™n D·ªãch V·ª•</th>
        <th>Gi√° d·ªãch v·ª•</th>
        <th>Ng√†y S·ª≠ D·ª•ng</th>
        <th>Tr·∫°ng Th√°i</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      {% for usage in usages %}
      <tr>
        <td>
          <a href="{% url 'usage_detail' usage.MaSuDung %}" class="btn btn-primary btn-sm">
            <b>{{ usage.MaSuDung }}</b>
          </a>
        </td>
        <td>{{ usage.TenKhachHang }}</td>
        <td>{{ usage.SoPhong }}</td>
        <td>{{ usage.TenDichVu }}</td>
        <td>{{ usage.GiaDichVu }}</td>
        <td>{{ usage.NgaySuDung|date:"d-m-Y" }}</td>
        <td>{{ usage.TrangThai }}</td>

        <td> <!-- N√∫t ch·ªânh s·ª≠a -->
          <a href="{% url 'edit_usage' usage.MaSuDung %}" class="btn btn-warning btn-sm">‚úèÔ∏è S·ª≠a</a>

          <!-- N√∫t x√≥a -->
          <form action="{% url 'delete_usage' usage.MaSuDung %}" method="post" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="so_phong" value=""> <!-- ƒê·∫£m b·∫£o c√≥ name -->
              <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√¥ng?');">
                  üóëÔ∏è X√≥a
              </button>
      </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}