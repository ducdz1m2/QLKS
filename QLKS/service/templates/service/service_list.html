{% extends 'base.html' %}
{% block title %}Danh s√°ch d·ªãch v·ª•{% endblock %}
{% load humanize %}

{% block content %}
<div class="container">
  <h2 class="text-center my-4">Danh s√°ch d·ªãch v·ª•</h2>

  <!-- N√∫t th√™m d·ªãch v·ª• -->
  <div class="text-end mb-3">
    <a href="{% url 'add_service' %}" class="btn btn-success">‚ûï Th√™m d·ªãch v·ª•</a>
  </div>

  <!-- Form t√¨m ki·∫øm -->
  <form method="GET" action="{% url 'search_services' %}" class="mb-3 p-3 bg-light rounded shadow-sm">
    <div class="row g-2 align-items-center">
      <div class="col-md-3">
        <input type="text" name="name" class="form-control" placeholder="Nh·∫≠p t√™n d·ªãch v·ª•" value="{{ request.GET.name }}">
      </div>
      <div class="col-md-3">
        <select name="min" class="form-select">
          <option value="">-- Gi√° t·ªëi thi·ªÉu --</option>
          <option value="0" {% if request.GET.min == "0" %}selected{% endif %}>0</option>
          <option value="100000" {% if request.GET.min == "100000" %}selected{% endif %}>100,000</option>
          <option value="200000" {% if request.GET.min == "200000" %}selected{% endif %}>200,000</option>
          <option value="500000" {% if request.GET.min == "500000" %}selected{% endif %}>500,000</option>
          <option value="1000000" {% if request.GET.min == "1000000" %}selected{% endif %}>1,000,000</option>
        </select>
      </div>
      <div class="col-md-3">
        <select name="max" class="form-select">
          <option value="">-- Gi√° t·ªëi ƒëa --</option>
          <option value="100000" {% if request.GET.max == "100000" %}selected{% endif %}>100,000</option>
          <option value="200000" {% if request.GET.max == "200000" %}selected{% endif %}>200,000</option>
          <option value="500000" {% if request.GET.max == "500000" %}selected{% endif %}>500,000</option>
          <option value="1000000" {% if request.GET.max == "1000000" %}selected{% endif %}>1,000,000</option>
          <option value="10000000" {% if request.GET.max == "10000000" %}selected{% endif %}>10,000,000</option>
        </select>
      </div>
      <div class="col-md-3">
        <select name="phongban" class="form-select">
          <option value="">-- Ch·ªçn ph√≤ng ban --</option>
          {% for pb in phongbans %}
            <option value="{{ pb.MaPhongBan }}" {% if request.GET.phongban == pb.MaPhongBan|stringformat:"s" %}selected{% endif %}>
              {{ pb.TenPhongBan }}
            </option>
          {% endfor %}
        </select>
      </div>
      
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100">üîç T√¨m ki·∫øm</button>
      </div>
    </div>
  </form>

  <!-- B·∫£ng danh s√°ch d·ªãch v·ª• -->
  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>M√£ d·ªãch v·ª•</th>
        <th>T√™n d·ªãch v·ª•</th>
        <th>Gi√° d·ªãch v·ª•</th>
        <th>Ph√≤ng ban</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      {% for service in services %}
      <tr style="cursor: pointer;" data-href="{% url 'service_detail' service.MaDichVu %}">
        <td>
          <a href="{% url 'service_detail' service.MaDichVu %}" class="btn btn-primary btn-sm">
            <strong>{{ service.MaDichVu }}</strong>
          </a>
        </td>
        <td>{{ service.TenDichVu }}</td>
        <td>{{ service.GiaDichVu|intcomma }} ‚Ç´</td>
        <td>{{ service.TenPhongBan }}</td>
        <td>
          <a href="{% url 'edit_service' service.MaDichVu %}" class="btn btn-warning btn-sm" onclick="event.stopPropagation();">‚úèÔ∏è S·ª≠a</a>
          <form action="{% url 'delete_service' service.MaDichVu %}" method="post" class="d-inline" onclick="event.stopPropagation();">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªãch v·ª• n√†y?');">üóëÔ∏è X√≥a</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">Kh√¥ng c√≥ d·ªãch v·ª• n√†o ph√π h·ª£p.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const rows = document.querySelectorAll('tr[data-href]');
      rows.forEach(row => {
        row.addEventListener('click', function () {
          window.location.href = row.getAttribute('data-href');
        });
      });
    });
  </script>
  
</div>
{% endblock %}
