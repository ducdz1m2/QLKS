{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">Đăng ký tài khoản</h2>

    <form method="post" action="" class="card p-4 shadow-lg">
        {% csrf_token %}

        <!-- Form chính -->
        <div class="mb-3">
            {{ user_form.as_p }}
            <div class="text-danger">{{ user_form.errors }}</div>
        </div>

        <!-- Form Nhân viên -->
        <div id="staff_form" class="mb-3" style="display:none;">
            <h3 class="mt-3">Thông tin Nhân viên</h3>
            {{ staff_form.as_p }}
            <div class="text-danger">{{ staff_form.errors }}</div>
        </div>

        <!-- Form Khách hàng -->
        <div id="customer_form" class="mb-3" style="display:none;">
            <h3 class="mt-3">Thông tin Khách hàng</h3>
            {{ customer_form.as_p }}
            <div class="text-danger">{{ customer_form.errors }}</div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Đăng ký</button>
    </form>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let roleField = document.querySelector("select[name='role']");
        let staffForm = document.getElementById("staff_form");
        let customerForm = document.getElementById("customer_form");

        function toggleForms() {
            let isStaff = roleField.value === "nhanvien";
            let isCustomer = roleField.value === "khachhang";

            staffForm.style.display = isStaff ? "block" : "none";
            customerForm.style.display = isCustomer ? "block" : "none";

            // Disable & remove required của input trong form bị ẩn
            document.querySelectorAll("#staff_form input, #staff_form select").forEach(el => {
                el.disabled = !isStaff;
                el.required = isStaff;
            });

            document.querySelectorAll("#customer_form input, #customer_form select").forEach(el => {
                el.disabled = !isCustomer;
                el.required = isCustomer;
            });
        }

        if (roleField) {
            roleField.addEventListener("change", toggleForms);
            toggleForms(); // Chạy 1 lần khi load trang
        }
    });
</script>
{% endblock %}
